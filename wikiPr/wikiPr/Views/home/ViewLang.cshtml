@model wikiPr.Models.Utilisateur
@using wikiPr.Models
@{ 
    string str = "";
    string langue = "Langue";
    string francais = "Francais";
    string anglais = "Anglais";
    string espagnol = "Espagnol";

    try {
        str = Request.ServerVariables["HTTP_ACCEPT_LANGUAGE"];
        Utilisateur u = Utilisateurs.FindByCourriel(User.Identity.Name);
        if (User.Identity.IsAuthenticated && u != null) { str = u.Langue; }
        //if (!User.Identity.IsAuthenticated) {
        //    Utilisateur ut = new Utilisateur(-1);
        //    string l = ut.Langue;
        //    if (l != "" && l != null) { str = l; }

    }
    catch { str = "fr"; }
    
    

    if (str.IndexOf("en") != -1) {
        langue = "Language";
        francais = "French";
        anglais = "English";
        espagnol = "Spanish";
    }

    if (str.IndexOf("es") != -1) {
        francais = "Francés";
        anglais = "Inglés";
        espagnol = "Español";
        langue = "Lengua";
    }
  }
  
@using (Html.BeginForm())
{
        @Html.AntiForgeryToken()

    <div class="form-horizontal">
       
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.Id)
        @*<form action="" name="lang">
            <select>
                <option value="" selected>@langue</option>
                <option value="fr" name="fr">@francais</option>
                <option value="en" name="en">@anglais</option>
                <option value="es" name="es">@espagnol</option>
            </select>
        </form>*@
        
            @*@Html.LabelFor(model => model.Langue, htmlAttributes: new { @class = "control-label col-md-2" })*@
           
                @Html.DropDownList("Langue", new List<SelectListItem> {
                new SelectListItem {Text=@langue, Value="", Selected=true},
                new SelectListItem {Text=@francais, Value="fr"},
                new SelectListItem {Text=@espagnol, Value="es"},
                new SelectListItem {Text=@anglais, Value="en"}

           },
                htmlAttributes: new {
                    @id = "lalang", @name="lalang"

                })
        @*<script>
            var saveclass = null;

            function saveLang(cookieValue)
            {
                var sel = document.getElementById('lalang');

                saveclass = saveclass ? saveclass : document.body.className;
                document.body.className = saveclass + ' ' + sel.value;

                setCookie('langue', cookieValue);
            }

            function setCookie(cookieName, cookieValue, nMinutes) {
                var today = new Date();
                var expire = new Date();

                if (nMinutes==null || nMinutes == 0)
                    nMinutes=30;

                expire.setTime(today.getTime() + nMinutes);
                document.cookie = cookieName+"="+escape(cookieValue) + ";expires="+expire.toGMTString();
            }

            function readCookie(name) {
                var nameEQ = name + "=";
                var ca = document.cookie.split(';');
                for(var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }

            document.addEventListener('DOMContentLoaded', function() {
                var LangSelect = document.getElementById('lalang');
                var selectedLang = readCookie('langue');

                LangSelect.value = selectedLang;
                saveclass = saveclass ? saveclass : document.body.className;
                document.body.className = saveclass + ' ' + selectedLang;
            });		   
        </script>*@

        @*@Html.DropDownListFor((x => x.Langue), new { Name = "lang" }, new List<SelectListItem>
            {
            new SelectListItem {Text=@langue, Value="fr", Selected=true},
            new SelectListItem {Text=@francais, Value="fr"},
            new SelectListItem {Text=@espagnol, Value="es"},
            new SelectListItem {Text=@anglais, Value="en"} }))*@



            <input type="submit" value="go" class="btn btn-default" />

</div>
}


